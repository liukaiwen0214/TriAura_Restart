<template>
  <header class="nav">
    <div class="left">
      <div class="logo">TRIAURA</div>

      <nav class="menus">
        <div class="group">
          <!-- å¤–å±‚ï¼šä¸¤è¡Œ -->
          <div class="groupMain">
            <span class="title">ç”Ÿæ´»</span>
            <span class="sub">è®°å½•ç¾å¥½ç”Ÿæ´»</span>
          </div>
          <!-- å†…å±‚ï¼šä¸‹æ‹‰ -->
          <div class="dropdown">
            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('life.manage')"
            >
              <i class="pi pi-book ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">ç”Ÿæ´»ç®¡ç†</div>
                <div class="ddDesc">æ—¥è®°ã€ä¹ æƒ¯ã€ç¢ç‰‡è®°å½•</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('life.finance')"
            >
              <i class="pi pi-wallet ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">è´¢åŠ¡ç®¡ç†</div>
                <div class="ddDesc">æ”¶æ”¯ã€é¢„ç®—ã€èµ„äº§æ¦‚è§ˆ</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('life.more')"
            >
              <i class="pi pi-ellipsis-h ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">æ›´å¤š</div>
                <div class="ddDesc">æŠŠå¸¸ç”¨å…¥å£éƒ½æ”¾è¿™</div>
              </div>
            </a>
          </div>
        </div>
        <div class="group">
          <!-- å¤–å±‚ï¼šä¸¤è¡Œ -->
          <div class="groupMain">
            <span class="title">å·¥ä½œ</span>
            <span class="sub">æ²¡æœ‰å¥½ä¸œè¥¿</span>
          </div>

          <!-- å†…å±‚ï¼šä¸‹æ‹‰ -->
          <div class="dropdown">
            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('work.project')"
            >
              <i class="pi pi-sitemap ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">é¡¹ç›®</div>
                <div class="ddDesc">è®¡åˆ’ã€è¿›åº¦ã€é‡Œç¨‹ç¢‘</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('work.files')"
            >
              <i class="pi pi-folder-open ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">é™„ä»¶</div>
                <div class="ddDesc">æ–‡æ¡£ã€èµ„æ–™ã€å½’æ¡£</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('work.notes')"
            >
              <i class="pi pi-file-edit ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">ç¬”è®°</div>
                <div class="ddDesc">çµæ„Ÿã€ä¼šè®®ã€å¤‡å¿˜</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('work.more')"
            >
              <i class="pi pi-ellipsis-h ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">æ›´å¤š</div>
                <div class="ddDesc">æŠŠå¸¸ç”¨å…¥å£éƒ½æ”¾è¿™</div>
              </div>
            </a>
          </div>
        </div>
        <div class="group">
          <!-- å¤–å±‚ï¼šä¸¤è¡Œ -->
          <div class="groupMain">
            <span class="title">æ¸¸æˆ</span>
            <span class="sub">ç”Ÿæ´»å†æƒ¨ä¹Ÿæ˜¯éœ€è¦å¿«ä¹</span>
          </div>

          <!-- å†…å±‚ï¼šä¸‹æ‹‰ -->
          <div class="dropdown">
            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('game.delta')"
            >
              <i class="pi pi-bolt ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">ä¸‰è§’æ´²</div>
                <div class="ddDesc">æˆ˜ç»©ã€é…ç½®ã€é˜Ÿå‹</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('game.onmyoji')"
            >
              <i class="pi pi-star ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">é˜´é˜³å¸ˆ</div>
                <div class="ddDesc">å¾¡é­‚ã€é˜µå®¹ã€æ¯æ—¥</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('game.stats')"
            >
              <i class="pi pi-chart-line ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">æ•°æ®</div>
                <div class="ddDesc">æŠ•å…¥æ—¶é—´ã€å¿«ä¹æŒ‡æ•°</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('game.more')"
            >
              <i class="pi pi-ellipsis-h ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">å…¶ä»–</div>
                <div class="ddDesc">å¶å°”æ¢ä¸ªä¸–ç•Œ</div>
              </div>
            </a>
          </div>
        </div>
        <div class="group">
          <!-- å¤–å±‚ï¼šä¸¤è¡Œ -->
          <div class="groupMain">
            <span class="title">å¨æˆ¿</span>
            <span class="sub">çŒ›çŒ›å¾—åƒ</span>
          </div>

          <!-- å†…å±‚ï¼šä¸‹æ‹‰ -->
          <div class="dropdown">
            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('kitchen.inventory')"
            >
              <i class="pi pi-box ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">åº“å­˜</div>
                <div class="ddDesc">å‰©ä½™ã€åˆ°æœŸã€æé†’</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('kitchen.ingredients')"
            >
              <i class="pi pi-tags ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">é£Ÿæ</div>
                <div class="ddDesc">åˆ†ç±»ã€æ‰¹æ¬¡ã€å•ä½</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('kitchen.recipes')"
            >
              <i class="pi pi-bookmark ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">é£Ÿè°±</div>
                <div class="ddDesc">æ”¶è—ã€åšè¿‡ã€æƒ³åš</div>
              </div>
            </a>

            <a
              class="ddItem"
              href="javascript:void(0)"
              @click.prevent="noop('kitchen.more')"
            >
              <i class="pi pi-ellipsis-h ddIcon"></i>
              <div class="ddText">
                <div class="ddTitle">æ›´å¤š</div>
                <div class="ddDesc">é‡‡è´­ã€æ¸…å•ã€ç»Ÿè®¡</div>
              </div>
            </a>
          </div>
        </div>
      </nav>
    </div>
    <div class="right">
      <!-- âœ… æ¶ˆæ¯ï¼šhover å°æ°”æ³¡ -->
      <div
        class="notifyWrap"
        @mouseenter="openNotify()"
        @mouseleave="closeNotify()"
      >
        <button class="iconBtn" title="æ¶ˆæ¯">
          <i class="pi pi-bell"></i>

          <!-- å¯é€‰ï¼šæœªè¯»å°ç‚¹ï¼ˆæœ‰æœªè¯»å°±æ˜¾ç¤ºï¼‰ -->
          <span v-if="hasUnread" class="dot" aria-hidden="true"></span>
        </button>
        <Transition name="pop" appear>
          <div class="notifyPanel" v-if="notifyOpen">
            <div class="notifyHead">
              <div class="notifyTitle">æ¶ˆæ¯</div>
              <div class="notifyCount">{{ visibleNotifs.length }} æ¡</div>
            </div>

            <div class="notifyList">
              <a
                v-for="n in visibleNotifs"
                :key="n.id"
                class="notifyItem"
                href="javascript:void(0)"
                @click.prevent="noop('notify:' + n.id)"
              >
                <div class="notifyTop">
                  <div class="notifyItemTitle" :class="{ unread: n.unread }">
                    {{ n.title }}
                  </div>

                  <!-- âœ… tagï¼šå³ä¸Šè§’ï¼Œæ·¡ä¸€ç‚¹ï¼Œä¸æŠ¢è§†çº¿ -->
                  <span v-if="n.tag" class="notifyTag">{{ n.tag }}</span>
                </div>
                <div class="notifyMeta" v-if="n.content || n.time">
                  <!-- âœ… hover çœ‹å…¨æ–‡ï¼šç”¨ title æœ€ç¨³ï¼Œä¸å½±å“ click/noop -->
                  <div
                    v-if="n.content"
                    class="notifyContent"
                    :title="n.content"
                  >
                    {{ n.content }}
                  </div>

                  <div v-if="n.time" class="notifyTime">
                    {{ n.time }}
                  </div>
                </div>
              </a>
            </div>

            <div class="notifyFoot">
              <button class="notifyMore" type="button" @click="viewMore">
                æŸ¥çœ‹æ›´å¤š
              </button>
            </div>
          </div>
        </Transition>
      </div>
      <!-- âœ… ä»»åŠ¡ï¼šhover å°é¢æ¿ + å›è½¦å¿«åŠ  + å¼¹çª—è¯¦ç»† -->
      <div class="taskWrap" @mouseenter="openTask()" @mouseleave="closeTask()">
        <button class="iconBtn" title="å¾…åŠ">
          <i class="pi pi-check-square"></i>
          <span
            v-if="pendingCount > 0"
            class="dot dotBlue"
            aria-hidden="true"
          ></span>
        </button>

        <Transition name="pop" appear>
          <div class="taskPanel" v-if="taskOpen">
            <div class="taskHead">
              <div class="taskTitle">å¾…åŠ</div>
              <div class="taskCount">{{ visibleTasks.length }} æ¡</div>
            </div>

            <!-- âœ… å¿«é€Ÿæ–°å¢ï¼šå›è½¦å°±åŠ ï¼ˆç®€æ˜“ï¼‰ -->
            <div class="taskQuick">
              <input
                v-model.trim="quickText"
                class="taskQuickInput"
                placeholder="å›è½¦æ·»åŠ ä¸€ä¸ªå¾…åŠâ€¦"
                @keydown.enter.prevent="addQuick()"
              />
              <button
                class="taskQuickPlus"
                type="button"
                @click="openTaskDialog()"
              >
                <i class="pi pi-plus"></i>
              </button>
            </div>

            <div class="taskList">
              <div
                v-for="t in visibleTasks"
                :key="t.id"
                class="taskItem"
                @click="openTaskItem(t)"
              >
                <label class="taskLeft">
                  <input
                    type="checkbox"
                    class="taskChk"
                    :checked="t.done"
                    @click.stop
                    @change="toggleDone(t.id)"
                  />
                </label>

                <div class="taskMid">
                  <!-- æ ‡é¢˜è¡Œï¼šç‚¹ + æ ‡é¢˜ï¼ˆåŒä¸€è¡Œï¼‰ -->
                  <div class="taskTopRow">
                    <span
                      class="prioDot"
                      :data-p="t.priority || 'MEDIUM'"
                    ></span>
                    <div class="taskItemTitle" :class="{ done: t.done }">
                      {{ t.title }}
                    </div>
                  </div>
                  <div v-if="t.note" class="taskNote">{{ t.note }}</div>
                </div>
                <!-- âœ… å³ä¾§ç‹¬ç«‹ä¸€åˆ—ï¼šä¸Š tag ä¸‹ time,ä¸”å’Œä¸­é—´ä¸¤è¡Œå¯¹é½ -->
                <div class="taskRight">
                  <span v-if="t.tag" class="taskTag">{{ t.tag }}</span>
                  <span v-if="t.time" class="taskTime">{{ t.time }}</span>
                </div>
              </div>
            </div>

            <div class="taskFoot">
              <button class="taskMore" type="button" @click="viewTaskMore">
                æŸ¥çœ‹æ›´å¤š
              </button>
            </div>
          </div>
        </Transition>
      </div>

      <!-- âœ… ä¸ªäººä¿¡æ¯ï¼šhover é¢æ¿ -->
      <div
        class="profileWrap"
        @mouseenter="openProfile()"
        @mouseleave="closeProfile()"
      >
        <div class="avatar" title="ä¸ªäººä¿¡æ¯">{{ avatarText }}</div>

        <Transition name="pop" appear>
          <div class="profilePanel" v-if="profileOpen">
            <!-- é¡¶éƒ¨ä¿¡æ¯ -->
            <div class="profileHead">
              <div class="profileAvatar">{{ avatarText }}</div>

              <div class="profileInfo">
                <div class="profileTop">
                  <div class="profileName" :title="displayName">
                    {{ displayName }}
                  </div>
                  <Badge
                    variant="secondary"
                    class="h-5 px-2 text-xs gap-1 bg-blue-500! text-white! hover:bg-blue-500! dark:bg-blue-600! dark:hover:bg-blue-600!"
                  >
                    <BadgeCheckIcon class="h-3.5 w-3.5" />
                    {{ roleText }}
                  </Badge>
                </div>
                <div class="profileSub" :title="accountText">
                  {{ accountText }}
                </div>
              </div>
            </div>

            <!-- å¿«æ·å…¥å£ -->
            <div class="profileActions">
              <button class="actionItem" type="button" @click="noop('profile')">
                <span>ä¸ªäººèµ„æ–™</span>
                <span class="chev">â€º</span>
              </button>

              <button class="actionItem" type="button" @click="noop('about')">
                <span>å…³äº</span>
                <span class="chev">â€º</span>
              </button>

              <button class="actionItem" type="button" @click="noop('switch')">
                <span>åˆ‡æ¢è´¦å·</span>
                <span class="chev">â€º</span>
              </button>

              <button class="actionItem danger" type="button" @click="doLogout">
                é€€å‡ºç™»å½•
              </button>
            </div>
          </div>
        </Transition>
      </div>
    </div>
    <div class="navLine" aria-hidden="true"></div>
  </header>

  <!-- å ä½ï¼šé¿å… fixed é¡¶æ å‹ä½å†…å®¹ -->
  <div class="navSpacer"></div>
</template>

<script setup lang="ts">
import { computed, ref } from "vue";
import { useRouter } from "vue-router";
import { toast } from "vue-sonner";
import { useAuth } from "@/auth/useAuth";
import { Badge } from "@/components/ui/badge";
import { BadgeCheckIcon } from "lucide-vue-next";

const router = useRouter();
const { state, logout } = useAuth();

// ä½ ä¹‹å‰çš„å ä½ç‚¹å‡»å‡½æ•°ï¼ˆä¿ç•™ï¼‰
function noop(key: string) {
  console.log("[nav-click]", key);
}

/** âœ… æ¶ˆæ¯æ•°æ®ç»“æ„ï¼ˆåç«¯ä»¥åæŒ‰è¿™ä¸ªåç»™ä½ å³å¯ï¼‰ */
type Notif = {
  id: string;
  title: string;
  content?: string;
  tag?: string; // æ—¥è®°/å¨æˆ¿/é˜´é˜³å¸ˆ/ä¸‰è§’æ´²â€¦ åç«¯ä¼ å•¥æ˜¾ç¤ºå•¥
  time?: string; // å»ºè®®åç«¯ç›´æ¥ä¼ å¯å±•ç¤ºæ–‡æœ¬
  unread?: boolean;
};

/** âœ… æš‚æ—¶ mock 5+ æ¡ï¼Œé¢æ¿åªæ˜¾ç¤º 5 æ¡ */
const notifications = ref<Notif[]>([
  {
    id: "n1",
    title: "ä»Šå¤©çš„æ—¥è®°è¿˜æ²¡å†™å®Œ",
    content: "ä½ å·²ç»è¿ç»­è®°å½• 3 å¤©äº†ï¼Œå†å†™ä¸€å¥å°±å®Œç¾ã€‚",
    tag: "æ—¥è®°",
    time: "åˆšåˆš",
    unread: true,
  },
  {
    id: "n2",
    title: "å¨æˆ¿åº“å­˜ï¼šç‰›å¥¶å¿«åˆ°æœŸ",
    content: "å»ºè®® 2 å¤©å†…ç”¨æ‰ï¼Œåšä¸ªæ‹¿é“ä¹Ÿè¡Œã€‚",
    tag: "å¨æˆ¿",
    time: "10 åˆ†é’Ÿå‰",
    unread: true,
  },
  {
    id: "n3",
    title: "é˜´é˜³å¸ˆï¼šä½“åŠ›æº¢å‡ºäº†",
    content: "åˆ«æµªè´¹å•¦ï¼Œåˆ·ä¸€æŠŠè§‰é†’ææ–™ã€‚",
    tag: "é˜´é˜³å¸ˆ",
    time: "1 å°æ—¶å‰",
    unread: false,
  },
  {
    id: "n4",
    title: "ä¸‰è§’æ´²ï¼šä»Šæ™šç»„é˜Ÿå—",
    content: "è€åœ°æ–¹é›†åˆï¼Œå¸¦ä¸Šæ¶ˆéŸ³ã€‚",
    tag: "ä¸‰è§’æ´²",
    time: "æ˜¨å¤©",
    unread: false,
  },
  {
    id: "n5",
    title: "è´¢åŠ¡ï¼šæœ¬å‘¨æ”¯å‡ºæœ‰ç‚¹å¤š",
    content: "å¤–å– + å¥¶èŒ¶å æ¯”æœ€é«˜ï¼ˆæ‡‚ä½ ğŸ˜Œï¼‰ã€‚",
    tag: "è´¢åŠ¡",
    time: "2 å¤©å‰",
    unread: false,
  },
  {
    id: "n6",
    title: "å·¥ä½œï¼šé¡¹ç›®æœ‰ 1 ä¸ªå¾…åŠ",
    content: "æŠŠæ¥å£ error code å¯¹é½ä¸€ä¸‹ã€‚",
    tag: "å·¥ä½œ",
    time: "3 å¤©å‰",
    unread: false,
  },
]);

const visibleNotifs = computed(() => notifications.value.slice(0, 5));
const hasUnread = computed(() => notifications.value.some((x) => x.unread));

/** âœ… hover å±•å¼€/æ”¶èµ·ï¼šåŠ ä¸€ç‚¹ç‚¹å»¶è¿Ÿï¼Œæ‰‹æ„Ÿæ›´æŸ”å’Œ */
const notifyOpen = ref(false);
let closeTimer: number | null = null;

function openNotify() {
  if (closeTimer) {
    window.clearTimeout(closeTimer);
    closeTimer = null;
  }
  notifyOpen.value = true;
}

function closeNotify() {
  // å°å»¶è¿Ÿé¿å…é¼ æ ‡è¾¹ç¼˜æŠ–åŠ¨å°±å…³æ‰
  if (closeTimer) window.clearTimeout(closeTimer);
  closeTimer = window.setTimeout(() => {
    notifyOpen.value = false;
  }, 120); // 120ms å¤ŸæŸ”ï¼Œä¸ä¼šå¡
}

function viewMore() {
  toast.info("æç¤º", { description: "åŠŸèƒ½æš‚ä¸æ”¯æŒ" });
}

// âœ… ä»»åŠ¡æ•°æ®ç»“æ„ï¼ˆåç«¯ä»¥åæŒ‰è¿™ä¸ªåç»™ä½ å³å¯ï¼‰
type Task = {
  id: string;
  title: string;
  note?: string;
  tag?: string; // æ—¥è®°/å¨æˆ¿/é˜´é˜³å¸ˆ/ä¸‰è§’æ´²â€¦ åç«¯ä¼ å•¥æ˜¾ç¤ºå•¥
  time?: string; // æ¯”å¦‚ï¼šä»Šå¤© / æ˜å¤© / 2å¤©å / 10:30
  done?: boolean;
  priority?: Priority; // âœ… æ–°å¢
};

// âœ… mockï¼šå…ˆç»™å‡ æ¡
const tasks = ref<Task[]>([
  {
    id: "t1",
    title: "æŠŠä»Šå¤©çš„æ—¥è®°è¡¥å®Œ",
    note: "å°±ä¸€å¥ä¹Ÿè¡Œ",
    tag: "æ—¥è®°",
    time: "ä»Šå¤©",
    done: false,
  },
  {
    id: "t2",
    title: "ç‰›å¥¶å¤„ç†æ‰",
    note: "æ‹¿é“ / éº¦ç‰‡",
    tag: "å¨æˆ¿",
    time: "2 å¤©å†…",
    done: false,
  },
  {
    id: "t3",
    title: "é˜´é˜³å¸ˆæ¸…ä½“åŠ›",
    note: "è§‰é†’ææ–™",
    tag: "é˜´é˜³å¸ˆ",
    time: "ä»Šæ™š",
    done: true,
  },
  {
    id: "t4",
    title: "ä¸‰è§’æ´²çœ‹çœ‹é…ç½®",
    note: "å¼€é»‘å‰æ£€æŸ¥",
    tag: "ä¸‰è§’æ´²",
    time: "å‘¨æœ«",
    done: false,
  },
  {
    id: "t5",
    title: "å¤ç›˜æœ¬å‘¨å¼€é”€",
    note: "å¤–å–å¥¶èŒ¶å¤ªå¤šäº†",
    tag: "è´¢åŠ¡",
    time: "æœ¬å‘¨",
    done: false,
  },
  {
    id: "t6",
    title: "ç»™é¡¹ç›®æ¥å£è¡¥ error code",
    tag: "å·¥ä½œ",
    time: "ä¸‹å‘¨",
    done: false,
  },
]);

// é¢æ¿åªæ˜¾ç¤º 5 æ¡ï¼ˆä½ å®šçš„ï¼‰
const visibleTasks = computed(() => tasks.value.slice(0, 5));
const pendingCount = computed(() => tasks.value.filter((t) => !t.done).length);

// âœ… hover å±•å¼€/æ”¶èµ·ï¼šå¾®å»¶è¿Ÿæ›´æŸ”å’Œ
const taskOpen = ref(false);
let taskCloseTimer: number | null = null;

function openTask() {
  if (taskCloseTimer) {
    window.clearTimeout(taskCloseTimer);
    taskCloseTimer = null;
  }
  taskOpen.value = true;
}

function closeTask() {
  if (taskCloseTimer) window.clearTimeout(taskCloseTimer);
  taskCloseTimer = window.setTimeout(() => {
    taskOpen.value = false;
  }, 120);
}

// âœ… å¿«é€Ÿæ–°å¢ï¼šå›è½¦å°±åŠ ï¼ˆç®€æ˜“ï¼‰
const quickText = ref("");
function addQuick() {
  const text = quickText.value.trim();
  if (!text) return;

  tasks.value.unshift({
    id: "t_" + Date.now(),
    title: text,
    done: false,
    // tag/time/note ä¸ºç©º â†’ ç®€æ˜“æ–°å¢
  });

  quickText.value = "";
}

// âœ… å‹¾é€‰å®Œæˆï¼šè½»è–„åŠ¨ç”»é  CSS åš
function toggleDone(id: string) {
  const t = tasks.value.find((x) => x.id === id);
  if (!t) return;
  t.done = !t.done;
}

// âœ… â€œæŸ¥çœ‹æ›´å¤šâ€ æš‚ä¸æ”¯æŒ â†’ toast
function viewTaskMore() {
  toast.info("åŠŸèƒ½æš‚ä¸æ”¯æŒ");
}

// âœ… è¯¦ç»†å¼¹çª—ï¼ˆå…ˆç•™æ¥å£ï¼Œä½ åé¢è¦ Dialog æˆ‘å†ç»™ä½ è¡¥å®Œæ•´ï¼‰
function openTaskDialog() {
  toast.info("è¯¦ç»†å¼¹çª—ä¸‹ä¸€æ­¥åŠ ");
}
function openTaskItem(t: any) {
  toast.info("åŠŸèƒ½æš‚ä¸æ”¯æŒ");
}

/** æ˜µç§°ä¼˜å…ˆï¼šdisplayName / usernameï¼›æ²¡æœ‰å°±ç”¨é‚®ç®±å‰ç¼€/æ‰‹æœºå·å4ä½å…œåº• */
const displayName = computed(() => {
  const me: any = state.me || {};
  return (
    me.displayName ||
    me.username ||
    (me.email ? String(me.email).split("@")[0] : "") ||
    (me.phone ? `ç”¨æˆ·${String(me.phone).slice(-4)}` : "") ||
    "æˆ‘çš„"
  );
});

/** ç¬¬äºŒè¡Œè´¦å·ï¼šé‚®ç®±ä¼˜å…ˆï¼Œå¦åˆ™æ‰‹æœºå·ï¼Œå¦åˆ™ id */
const accountText = computed(() => {
  const me: any = state.me || {};
  return me.email || me.phone || me.id || "";
});

/** è§’è‰² */
const roleText = computed(() => {
  const me: any = state.me || {};
  return me.role || "USER";
});
const roleVariant = computed(() => {
  const r = roleText.value;
  if (r === "OWNER") return "secondary";
  if (r === "ADMIN") return "default";
  return "outline";
});
/** å¤´åƒå­—æ¯ï¼šå–æ˜µç§°é¦–å­—æ¯ï¼ˆä¸­æ–‡å°±ç›´æ¥å–ç¬¬ä¸€ä¸ªå­—ï¼‰ */
const avatarText = computed(() => {
  const n = (displayName.value || "K").trim();
  return n.slice(0, 1).toUpperCase();
});

/** hover å±•å¼€/æ”¶èµ·ï¼ˆåŠ ä¸€ç‚¹å»¶è¿Ÿï¼Œæ‰‹æ„Ÿæ›´è½¯ï¼‰ */
const profileOpen = ref(false);
let profileCloseTimer: number | null = null;

function openProfile() {
  if (profileCloseTimer) {
    window.clearTimeout(profileCloseTimer);
    profileCloseTimer = null;
  }
  profileOpen.value = true;
}

function closeProfile() {
  if (profileCloseTimer) window.clearTimeout(profileCloseTimer);
  profileCloseTimer = window.setTimeout(() => {
    profileOpen.value = false;
  }, 140);
}

function goProfile() {
  // å…ˆå ä½ï¼šåé¢ä½ åšé¡µé¢äº†æ”¹æˆ router.push(...)
  toast("åŠŸèƒ½æš‚æœªå¼€æ”¾", { description: "ä¸ªäººèµ„æ–™é¡µé¢åç»­ä¸Šçº¿" });
  profileOpen.value = false;
}

function goAbout() {
  toast("TriAura", { description: "Â© 2026 TriAura Â· é²ICPå¤‡2026006101å·" });
  profileOpen.value = false;
}

function switchAccount() {
  toast("åŠŸèƒ½æš‚æœªå¼€æ”¾", { description: "åˆ‡æ¢è´¦å·åç»­æ”¯æŒ" });
  profileOpen.value = false;
}

async function doLogout() {
  try {
    await logout();
  } finally {
    profileOpen.value = false;
    router.replace("/auth?tab=login");
  }
}
</script>

<style scoped>
/* é¡¶æ ç»ç’ƒ */
.nav {
  position: fixed;
  top: 14px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;

  width: min(1320px, calc(100% - 48px));
  height: 54px;
  border-radius: 9px;
  overflow: visible;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 0 14px;
  -webkit-backdrop-filter: blur(18px) saturate(160%);
  transition:
    opacity 0.18s ease,
    background-color 0.18s ease,
    border-color 0.18s ease,
    box-shadow 0.18s ease,
    backdrop-filter 0.18s ease;
}
.navLine {
  position: absolute;
  left: 1px;
  right: 1px; /* âœ… çº¿æ›´é•¿ï¼šæƒ³æ›´é•¿å°±æ”¹æˆ 10px / 8px */
  bottom: 0;
  height: 1px;
  pointer-events: none;

  background: linear-gradient(
    90deg,
    rgba(15, 23, 42, 0),
    rgba(15, 23, 42, 0.1) 18%,
    rgba(15, 23, 42, 0.18) 50%,
    rgba(15, 23, 42, 0.1) 82%,
    rgba(15, 23, 42, 0)
  );
  opacity: 0.9;
  z-index: 3;
}
/* å ä½é«˜åº¦ï¼š54 + top 14 + é¢å¤–é—´è· */
.navSpacer {
  height: 84px;
}

/* å†…å®¹å¸ƒå±€ */
.left {
  display: flex;
  align-items: center;
  gap: 14px;
}
.logo {
  font-weight: 900;
  letter-spacing: 0.8px;
  font-size: 14px;
  color: #0b1220;
  user-select: none;
}
.menus {
  display: flex;
  overflow: visible;
  align-items: center;
  gap: 10px;
}
.group {
  position: relative;
}
/* âœ… hover æ¡¥ï¼šè®©é¼ æ ‡ä» groupMain ç§»åˆ° dropdown æ—¶ä¸æ‰ hover */
.group::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 100%;
  height: 14px; /* è¿™ä¸ªå°±æ˜¯é€šé“é«˜åº¦ */
}
.groupMain {
  display: flex;
  flex-direction: column;
  gap: 2px;
  padding: 6px 10px;
  border-radius: 9px;
  cursor: pointer;
  align-items: center; /* âœ… ä¸¤è¡Œå±…ä¸­ */
  text-align: center; /* âœ… æ–‡æœ¬å±…ä¸­ */
  transition: background 0.15s ease;
}
.group:hover .groupMain {
  background: rgba(15, 23, 42, 0.06);
}
.dropdown {
  position: absolute;
  left: 50%;
  top: 100%;
  transform: translateX(-50%) translateY(-6px);
  opacity: 0;
  pointer-events: none;

  min-width: 190px;
  padding: 10px;
  border-radius: 14px;
  z-index: 2000;

  /* âœ… ç»ç’ƒï¼šç”¨â€œä½ä¸é€æ˜åº¦ç™½â€è®©èƒŒæ™¯æ¸å˜é€å‡ºæ¥ï¼Œè€Œä¸æ˜¯ç…ç™½ */
  background: rgba(255, 255, 255, 0.42);

  /* âœ… å¾ˆæµ…çš„è¾¹ç•Œï¼Œè®©å®ƒä»èƒŒæ™¯é‡Œâ€œåˆ†ç¦»â€å‡ºæ¥ä¸€ç‚¹ç‚¹ */
  border: 1px solid rgba(255, 255, 255, 0.35);

  /* âœ… è½»è½»çš„é˜´å½± + å†…é«˜å…‰ï¼Œå¢åŠ å±‚æ¬¡ä½†ä¸ç¡¬ */
  box-shadow:
    0 22px 55px rgba(15, 23, 42, 0.1),
    0 1px 0 rgba(255, 255, 255, 0.55) inset;

  /* âœ… æ¨¡ç³Š + é¥±å’Œåº¦ï¼šç»ç’ƒæ„Ÿæ ¸å¿ƒ */
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);

  transition:
    opacity 0.16s ease,
    transform 0.16s ease;
}
.group:hover .dropdown {
  opacity: 1;
  transform: translateX(-50%) translateY(8px); /* âœ… è§†è§‰å¾€ä¸‹è½ä¸€ç‚¹ï¼Œä½†ä¸ç•™ç©ºéš™ */
  pointer-events: auto;
}

/* å†…å±‚ itemï¼šä¸€è¡Œä¸€ä¸ª */
.ddItem {
  display: grid;
  grid-template-columns: 34px 1fr;
  gap: 10px;
  align-items: center;

  padding: 10px 12px;
  border-radius: 12px;
  text-decoration: none;

  color: #0b1220;
  background: rgba(255, 255, 255, 0); /* é»˜è®¤é€æ˜ï¼Œhover å†ç»™é«˜å…‰ */
  transition:
    background 0.15s ease,
    transform 0.15s ease;
}
.ddIcon {
  width: 34px;
  height: 34px;
  border-radius: 10px;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 15px;
  color: rgba(15, 23, 42, 0.72);

  background: rgba(15, 23, 42, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.35);
}
.ddItem:hover {
  background: rgba(15, 23, 42, 0.06);
  transform: translateY(-1px);
}
.ddText {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.ddTitle {
  font-size: 13px;
  font-weight: 800;
  line-height: 1.2;
}

.ddDesc {
  font-size: 12px;
  color: rgba(100, 116, 139, 0.95);
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ddItem:hover {
  background: rgba(15, 23, 42, 0.06);
  transform: translateY(-1px);
}

/* hover æ—¶ icon æ›´äº®ä¸€ç‚¹ç‚¹ */
.ddItem:hover .ddIcon {
  background: rgba(15, 23, 42, 0.08);
  color: rgba(15, 23, 42, 0.85);
}
.title {
  font-size: 12px;
  font-weight: 700;
  color: #0b1220;
}
.sub {
  font-size: 11px;
  color: #64748b;
}

/* å³ä¾§ */
.right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.iconBtn {
  width: 36px;
  height: 36px;
  border-radius: 9px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.55);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    background 0.15s ease,
    transform 0.15s ease;
}
.iconBtn:hover {
  background: rgba(255, 255, 255, 0.75);
  transform: translateY(-1px);
}
/* ========== Notify Popover ========== */
.notifyWrap {
  position: relative;
  display: flex;
  align-items: center;
}

.iconBtn {
  position: relative; /* ä¸ºæœªè¯»ç‚¹å®šä½ */
}

.dot {
  position: absolute;
  right: 8px;
  top: 8px;
  width: 7px;
  height: 7px;
  border-radius: 999px;
  background: rgba(239, 68, 68, 0.95);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.7);
}

/* é¢æ¿ï¼šç»ç’ƒã€åŠé€æ˜ã€åƒèƒŒæ™¯ */
.notifyPanel {
  position: absolute;
  top: calc(100% + 10px);
  left: 50%;
  transform: translateX(-50%);
  /* âœ… å¦‚æœä½ è¿˜æƒ³åŠ ä¸€ç‚¹â€œè½ä¸‹æ¥çš„æ„Ÿè§‰â€ï¼Œç”¨è¿™ä¸€è¡Œæ›¿æ¢ä¸Šé¢ transformï¼š
     transform: translateX(-50%) translateY(2px);
  */

  width: 320px;
  border-radius: 12px;
  padding: 10px;
  z-index: 3000;

  background: rgba(255, 255, 255, 0.62);
  border: 1px solid rgba(255, 255, 255, 0.55);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);
}

/* å¤´éƒ¨ */
.notifyHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 6px 8px 6px;
}
.notifyTitle {
  font-size: 13px;
  font-weight: 800;
  color: #0b1220;
}
.notifyCount {
  font-size: 12px;
  color: #64748b;
}

/* åˆ—è¡¨ */
.notifyList {
  display: grid;
  gap: 6px;
  padding: 2px;
}

.notifyItem {
  display: block;
  text-decoration: none;
  border-radius: 10px;
  padding: 10px 10px;
  color: inherit;
  transition:
    background 0.15s ease,
    transform 0.15s ease;
  background: rgba(255, 255, 255, 0.3);
  border: 1px solid rgba(15, 23, 42, 0.06);
}
.notifyItem:hover {
  background: rgba(255, 255, 255, 0.5);
  transform: translateY(-1px);
}

.notifyTop {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
}

.notifyItemTitle {
  font-size: 13px;
  font-weight: 800;
  color: #0b1220;
  line-height: 1.2;
}
.notifyItemTitle.unread {
  /* æœªè¯»ç¨å¾®æ›´å¼ºè°ƒä¸€ç‚¹ç‚¹å³å¯ */
  text-shadow: 0 0 0 rgba(0, 0, 0, 0);
}
.notifyMeta {
  margin-top: 6px;
  display: flex;
  align-items: baseline;
  gap: 10px;
}

/* âœ… tagï¼šå³ä¸Šè§’ï¼Œå°ã€æ·¡ã€ä¸æŠ¢æ ‡é¢˜ */
.notifyTag {
  font-size: 11px;
  font-weight: 700;
  color: rgba(15, 23, 42, 0.45);
  background: rgba(255, 255, 255, 0.35);
  border: 1px solid rgba(15, 23, 42, 0.06);
  padding: 2px 8px;
  border-radius: 999px;
  white-space: nowrap;
  flex: 0 0 auto;
}

.notifyContent {
  flex: 1;
  min-width: 0; /* å…³é”®ï¼šå…è®¸ ellipsis ç”Ÿæ•ˆ */
  font-size: 13px;
  line-height: 1.3;
  color: rgba(15, 23, 42, 0.74); /* æ¯”æ ‡é¢˜æ·¡ä¸€ç‚¹ï¼Œè½»è–„ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.notifyTime {
  margin-top: 6px;
  font-size: 11px;
  color: #94a3b8;
}

/* åº•éƒ¨ */
.notifyFoot {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid rgba(15, 23, 42, 0.06);
  display: flex;
  justify-content: center;
}
.notifyMore {
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 12px;
  font-weight: 800;
  color: #0b1220;
  padding: 8px 10px;
  border-radius: 9px;
  transition: background 0.15s ease;
}
.notifyMore:hover {
  background: rgba(15, 23, 42, 0.06);
}
/* é¢æ¿å‡ºç°/æ¶ˆå¤±ï¼šæŸ”å’Œä¸€ç‚¹ */
.pop-enter-active,
.pop-leave-active {
  transition:
    opacity 0.16s ease,
    transform 0.16s ease,
    filter 0.16s ease;
  will-change: opacity, transform, filter;
}

.pop-enter-from,
.pop-leave-to {
  opacity: 0;
  transform: translateX(-50%) translateY(-6px) scale(0.98);
  filter: blur(6px);
}

.pop-enter-to,
.pop-leave-from {
  opacity: 1;
  transform: translateX(-50%) translateY(0) scale(1);
  filter: blur(0);
}
.avatar {
  width: 36px;
  height: 36px;
  border-radius: 9px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: #0b1220;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.55);
}
/* ====== Tasks Popover ====== */
.taskWrap {
  position: relative;
  display: flex;
  align-items: center;
}

.dotBlue {
  background: rgba(59, 130, 246, 0.95);
}

.taskPanel {
  position: absolute;
  top: calc(100% + 10px);
  left: 50%;
  transform: translateX(-50%);
  width: 340px;
  border-radius: 12px;
  padding: 10px;
  z-index: 3000;

  background: rgba(255, 255, 255, 0.62);
  border: 1px solid rgba(255, 255, 255, 0.55);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);
}

.taskHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 6px 8px 6px;
}
.taskTitle {
  font-size: 13px;
  font-weight: 800;
  color: #0b1220;
}
.taskCount {
  font-size: 12px;
  color: #64748b;
}

/* å¿«åŠ  */
.taskQuick {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 2px 4px 10px 4px;
}
.taskQuickInput {
  flex: 1;
  height: 36px;
  border-radius: 10px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.45);
  padding: 0 12px;
  outline: none;
  font-size: 12px;
  color: #0b1220;
}
.taskQuickInput:focus {
  border-color: rgba(15, 23, 42, 0.18);
  background: rgba(255, 255, 255, 0.55);
}
.taskQuickPlus {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.45);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    background 0.15s ease,
    transform 0.15s ease;
}
.taskQuickPlus:hover {
  background: rgba(255, 255, 255, 0.62);
  transform: translateY(-1px);
}

/* åˆ—è¡¨ */
.taskList {
  display: grid;
  gap: 6px;
  padding: 2px;
}

.taskItem {
  position: relative;
  border-radius: 12px;
  padding: 10px 10px;
  background: rgba(255, 255, 255, 0.3);
  border: 1px solid rgba(15, 23, 42, 0.06);

  display: grid;
  grid-template-columns: 22px 1fr 72px; /* âœ… å³ä¾§åˆ—å›ºå®šï¼Œæ’ç‰ˆæ›´ç¨³ */
  gap: 10px;
  align-items: start;
  cursor: pointer;

  transition:
    background 0.15s ease,
    transform 0.15s ease;
}
.taskItem:hover {
  background: rgba(255, 255, 255, 0.45);
  transform: translateY(-1px);
  transition:
    background 0.15s ease,
    transform 0.15s ease;
}

.taskLeft {
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 2px;
}
.taskChk {
  width: 16px;
  height: 16px;
}

.taskMid {
  min-width: 0;
}
.taskRight {
  display: grid;
  grid-template-rows: auto auto; /* ä¸¤è¡Œï¼šä¸Š=tagï¼Œä¸‹=time */
  row-gap: 6px;
  justify-items: end; /* å³å¯¹é½ */
  align-content: start; /* ä»ä¸Šå¼€å§‹æ’ */
}
.taskTopRow {
  display: grid;
  align-items: center;
  justify-content: space-between;
  grid-template-columns: 10px 1fr 15px; /* å·¦ dot ä½ | æ ‡é¢˜ä½ | å³å ä½ */
  gap: 10px;
}
.taskItemTitle {
  font-size: 13px;
  font-weight: 750;
  color: #0b1220;
  line-height: 1.2;

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;

  cursor: pointer;
}
.taskItemTitle.done {
  opacity: 0.55;
  text-decoration: line-through;
}

.taskTag {
  font-size: 11px;
  font-weight: 700;
  color: rgba(15, 23, 42, 0.45);
  background: rgba(255, 255, 255, 0.35);
  border: 1px solid rgba(15, 23, 42, 0.06);
  padding: 2px 8px;
  border-radius: 999px;
  white-space: nowrap;
}

.taskNote {
  font-size: 12px;
  color: rgba(15, 23, 42, 0.68);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.25;
  margin-top: 12px; /* è®©å¤‡æ³¨å’Œæ ‡é¢˜çš„è·ç¦»å›ºå®š */
}

.taskTime {
  font-size: 11px;
  color: #94a3b8;
  white-space: nowrap;
  justify-self: end;
  align-self: start; /* æˆ– baselineï¼ˆçœ‹ä½ æµè§ˆå™¨æ•ˆæœï¼‰ */
  margin-top: 2px; /* å¾®è°ƒï¼šè®©å®ƒæ›´è´´è¿‘å¤‡æ³¨è¡Œ */
}

/* åº•éƒ¨ */
.taskFoot {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid rgba(15, 23, 42, 0.06);
  display: flex;
  justify-content: center;
}
.taskMore {
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 12px;
  font-weight: 800;
  color: #0b1220;
  padding: 8px 10px;
  border-radius: 9px;
  transition: background 0.15s ease;
}
.taskMore:hover {
  background: rgba(15, 23, 42, 0.06);
}
/* æ ‡é¢˜è¡Œï¼šè®©ç‚¹å’Œæ ‡é¢˜ç¨³ç¨³å¯¹é½ */
.todoTitleRow {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

/* å°åœ†ç‚¹æœ¬ä½“ */
.prioDot {
  display: inline-block; /* âœ… é¿å… inline baseline æ£ä¹± */
  width: 8px;
  height: 8px;
  border-radius: 999px;
  flex: 0 0 auto;
  align-self: center; /* âœ… åŒä¿é™© */
  margin: 0; /* âœ… æ¸…æ‰å¯èƒ½çš„æ—§ margin-top */
  opacity: 0.92;

  /* è½»è½»çš„å…‰åœˆï¼šæ›´è½¯ */
  box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.04);
}

/* é¢œè‰²ï¼šä¸åˆºçœ¼ï¼Œåâ€œå¥¶æ²¹æ„Ÿâ€ */
.prioDot[data-p="HIGH"] {
  background: rgba(239, 68, 68, 0.85);
  box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
}
.prioDot[data-p="MEDIUM"] {
  background: rgba(245, 158, 11, 0.78);
  box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
}
.prioDot[data-p="LOW"] {
  background: rgba(100, 116, 139, 0.55);
  box-shadow: 0 0 0 4px rgba(100, 116, 139, 0.08);
}

/* æ ‡é¢˜ä¸è¦è¢«æŒ¤å‹ */
.todoTitle {
  font-weight: 800;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
/* ========== Profile Popover ========== */
.profileWrap {
  position: relative;
  display: flex;
  align-items: center;
}

/* é¢æ¿ï¼šç»ç’ƒã€åŠé€æ˜ã€åƒèƒŒæ™¯ */
.profilePanel {
  position: absolute;
  top: calc(100% + 10px);
  /* âœ… ä»¥å¤´åƒæŒ‰é’®ä¸ºä¸­å¿ƒç‚¹ */
  left: 50%;
  right: auto;
  transform: translateX(-50%);
  width: 300px;
  border-radius: 12px;
  padding: 10px;
  z-index: 3500;

  background: rgba(255, 255, 255, 0.62);
  border: 1px solid rgba(255, 255, 255, 0.55);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);

  transform: translateX(-50%) translateY(2px);
}

/* é¡¶éƒ¨ */
.profileHead {
  display: grid;
  grid-template-columns: 40px 1fr;
  gap: 10px;
  padding: 6px 6px 10px 6px;
  align-items: center;
}

.profileAvatar {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;

  font-weight: 900;
  color: #0b1220;
  border: 1px solid rgba(15, 23, 42, 0.08);
  background: rgba(255, 255, 255, 0.55);
}

.profileInfo {
  min-width: 0;
}

.profileTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.profileName {
  font-size: 13px;
  font-weight: 900;
  color: #0b1220;
  line-height: 1.2;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.profileRole {
  font-size: 11px;
  font-weight: 800;
  color: rgba(15, 23, 42, 0.55);
  background: rgba(255, 255, 255, 0.35);
  border: 1px solid rgba(15, 23, 42, 0.06);
  padding: 2px 8px;
  border-radius: 999px;
  white-space: nowrap;
  flex: 0 0 auto;
}

.profileSub {
  margin-top: 4px;
  font-size: 12px;
  color: rgba(15, 23, 42, 0.6);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* åˆ—è¡¨ */
.profileList {
  display: grid;
  gap: 6px;
  padding: 2px;
}

.profileItem {
  width: 100%;
  text-align: left;
  border: 1px solid rgba(15, 23, 42, 0.06);
  background: rgba(255, 255, 255, 0.3);
  color: #0b1220;

  padding: 10px 10px;
  border-radius: 10px;
  cursor: pointer;

  font-size: 12px;
  font-weight: 800;

  transition:
    background 0.15s ease,
    transform 0.15s ease;
}

.profileItem:hover {
  background: rgba(255, 255, 255, 0.5);
  transform: translateY(-1px);
}

/* åº•éƒ¨ */
.profileFoot {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid rgba(15, 23, 42, 0.06);
}

.profileLogout {
  width: 100%;
  border: none;
  background: rgba(15, 23, 42, 0.06);
  color: #0b1220;

  padding: 10px 10px;
  border-radius: 10px;
  cursor: pointer;

  font-size: 12px;
  font-weight: 900;

  transition:
    background 0.15s ease,
    transform 0.15s ease;
}
.profileLogout:hover {
  background: rgba(15, 23, 42, 0.1);
  transform: translateY(-1px);
}
.roleBadge {
  height: 22px;
  padding: 0 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.2px;
}

.profileActions {
  display: grid;
  gap: 10px;
  margin-top: 12px;
}

.actionItem {
  height: 44px;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.06);
  background: rgba(255, 255, 255, 0.28);
  backdrop-filter: blur(10px) saturate(140%);
  -webkit-backdrop-filter: blur(10px) saturate(140%);

  padding: 0 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;

  font-size: 13px;
  font-weight: 800;
  color: #0b1220;

  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.15s ease,
    border-color 0.15s ease;
}

.actionItem:hover {
  background: rgba(255, 255, 255, 0.46);
  border-color: rgba(15, 23, 42, 0.1);
  transform: translateY(-1px);
}

.chev {
  font-size: 18px;
  line-height: 1;
  color: rgba(15, 23, 42, 0.35);
}

.actionItem.danger {
  background: rgba(239, 68, 68, 0.08);
  border-color: rgba(239, 68, 68, 0.18);
  color: rgba(185, 28, 28, 1);
  justify-content: center;
}

.actionItem.danger:hover {
  background: rgba(239, 68, 68, 0.12);
}
@media (min-width: 1600px) {
  .nav {
    width: min(1500px, calc(100% - 64px));
  }
}
</style>
